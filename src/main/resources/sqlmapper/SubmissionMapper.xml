<?xml version="1.0" encoding="UTF-8"?>


<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.minh.nguyen.mapper.SubmissionMapper">
    <select id="getSubmission" resultType="SubmissionDTO">
        SELECT
            submission.id          AS id,
            problem.name           AS pmNm,
            submission.memoryUsed  AS memoryUsed,
            submission.timeRun     AS timeRun,
            submission.createTime  AS createTime,
            submission.judgeStatus AS judgeStatus,
            submission.verdict     AS verdict,
            language.name          AS leNm
        FROM submission
            LEFT JOIN problem
                ON submission.pmId = problem.id
                   AND submission.deleteFlg = '0'
            LEFT JOIN language
                ON submission.leId = language.id
                   AND language.deleteFlg = '0'
        WHERE submission.deleteFlg = '0'
            ORDER BY submission.createTime DESC
        LIMIT 100
    </select>
    <select id="getSubmitDetail" resultMap="submission">
        SELECT
            submission.id          AS id,
            problem.name           AS pmNm,
            submission.memoryUsed  AS memoryUsed,
            submission.timeRun     AS timeRun,
            submission.createTime  AS createTime,
            submission.judgeStatus AS judgeStatus,
            submission.verdict     AS verdict,
            submission.sourceCode  AS sourceCode,
            language.name          AS leNm,
            submitdetail.id     AS sDlId,
            submitdetail.input     AS input,
            submitdetail.output    AS output,
            submitdetail.result    AS result,
            submitdetail.answer    AS answer
        FROM submission
            LEFT JOIN problem
                ON submission.pmId = problem.id
                   AND submission.deleteFlg = '0'
            LEFT JOIN language
                ON submission.leId = language.id
                   AND language.deleteFlg = '0'
            LEFT JOIN sn_sdl
                ON submission.id = sn_sdl.snId
                AND sn_sdl.deleteFlg = '0'
            LEFT JOIN submitdetail
                on sn_sdl.sDlId = submitdetail.id
        WHERE submission.deleteFlg = '0'
            AND submission.id=#{snId}
    </select>
    <resultMap id="submission" type="SubmissionDTO">
        <id column="id" property="id"/>
        <result column="pmNm" property="pmNm"/>
        <result column="timeRun" property="timeRun"/>
        <result column="memoryUsed" property="memoryUsed"/>
        <result column="sourceCode" property="sourceCode"/>
        <result column="createTime" property="createTime"/>
        <result column="verdict" property="verdict"/>
        <result column="judgeStatus" property="judgeStatus"/>
        <result column="submitTime" property="submitTime"/>
        <result column="leNm" property="leNm"/>
        <collection property="lstSubmitDetail" ofType="SubmitDetailDTO">
            <id column="sDlId" property="id"/>
            <result column="input" property="input"/>
            <result column="output" property="output"/>
            <result column="result" property="result"/>
            <result column="answer" property="answer"/>
        </collection>
    </resultMap>
</mapper>